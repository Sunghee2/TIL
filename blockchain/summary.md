# BlockChain

화폐의 실체는 믿음이다. 금으로 교환해 준다는 보장은 사라졌지만 화폐로 여전히 치킨을 먹고 맥주를 마실 수 있다고 모두가 믿고 있다. 화폐는 모두의 '신뢰'를 받고 있는 것이다. 비트코인이 암호'화폐'와 같은 용어를 달고 있는 이유도 '신뢰'할 만한 대상이 될 수 있기 때문이다. 그리고 그 신뢰의 원천이 바로 블록체인 이다.

- **블록체인, 거대한 분산 공개 장부**

  송금 과정은 은행에서 수행되며 그 기록도 은행에 저장된다. 이런 조치를 위해서는 보안을 위해 많은 비용이 수반된다. 하지만 블록체인은 거래 정보를 감추지 않고 모두에게 공개하고 누구나 거래 정보를 생성할 수 있으며 거래 정보를 모두에게 복사해 사본을 저장하고 그 사본끼리 내용을 서로 맞춘다. 수천~수만중화 처리로 기록이 사라지는 일을 원천적으로 막고 내용이 맞지 않는 사본은 폐기하는 것이다. 그래서 블록체인을 거대한 '분산 공개 장부'라고 부르기도 한다. 

  이렇게 기록이 없어지는 것을 막을 수 있지만 이것만으로는 기록의 위 변조까지 막을 수는 없다. 또한 거래의 진위 여부를 확인할 수도 없다. 이는 암호학의 도움을 받아 해결한다. 

- **모든 거래 정보에 디지털 서명 포함**

  인터넷 뱅킹을 이용해 송금할 때 우리는 공인인증서를 사용하는데 이것이 바로 디지털 서명이다. 디지털 서명을 통해 그 송금이 진본이라는 것을 입증할 수 있고 송금 사실을 나중에 부인할 수 없게 된다. 이것은 암호학을 바탕으로 만들어져 있다. 블록체인에 담겨 있는 모든 거래 정보에는 디지털 서명이 포함되어 있어 거래 정보가 진본이라는 것을 신뢰할 수 있다. 

  ![img](http://magazine.hankyung.com/magazinedata/images/photo/201802/7a909e27d6ec8ee9d2146d555945f8c9.jpg)

  하나의 블록에는 여러 개의 거래가 포함된다. 비트코인 블록 하나에는 약 2000개의 거래 정보가 포함될 수 있고 블록 하나의 물리적인 크기는 약 1MB다. 블록은 블록 헤더와 거래 정보, 기타 정보로 구성된다. 블록 헤더는 또 소프트웨어 버전, 앞 블록의 고유 번호, 블록 내 모든 거래 정보의 해시 값, 블록 생성 시작 시간, 난이도, 난스(Nonce: Number used once) 등 6가지 정보로 구성된다. 거래 정보는 다수의 입출금 거래 정보로 구성된다. 기타 정보에는 블록 헤더와 거래 정보에 포함되지 않는 데이터로 구성된다.

  블록체인은 이러한 블록들이 이어져 만들어진 블록의 집합체다. 블록 헤더의 앞 블록의 블록 고유번호를 기준으로 블록들이 이어져 있다. 

- 블록체인의 핵심, 1. 작업 증명과 보상

  블록체인이 신뢰의 원천이 될 수 있는 첫째 핵심 요소는 작업 증명(POW: Proof of Work)이다. 흔히 '어려운 수학 문제를 푼다'정도로 설명되기도 하는데 작업 증명은 새로 만든 블록의 고유 번호를 계산하고 새 블록을 블록체인에 이어 붙이는 작업을 완료했다는 것을 증명하는 것이다. 수학 문제는 결국 블록의 고유 번호를 계산하는 것을 말한다. 고유 번호를 계산하는 이유는 고유 번호가 있어야 블록을 블록체인에 연결할 수 있기 때문이다. 블록의 고유 번호는 hash라는 함수를 통해 계산된다.

   다행히 블록체인을 이해하는데 해시 함수를 수학적으로 분석할 필요는 없다. 패스트푸드점에서 흔히 볼 수 있는 해시브라운을 떠올려보자. 감자를 으깨고(hash) 튀기면 해시브라운이 나온다. 똑같은 감자를 으깨고 튀기면 언제나 똑같은 맛과 크기의 해시브라운이 나온다. 하지만 반대로 해시브라운을 다시 감자로 만들 수는 없다. 그래서 어떤 감자를 으깨야 특정한 맛과 크기의 해시브라운이 나오는지 추측할 수 없다. 특정한 맛과 크기의 해시브라운을 얻으려면 감자를 여러 번 바꿔 가면서 으깨고 튀겨본 후 맛과 크기를 비교해 볼 수밖에 없다. 감자와 해시브라운 사례를 통해 입력 값이 같으면 해시의 계산 결과 값은 항상 같게 나온다는 것을 이해할 수 있다. 또 특정 값이 나오는 입력 값을 예측할 수 없고 그래서 직접 계산해 보지 않고서는 답을 구할 수 없다는 것도 파악할 수 있다.

   해시 계산을 한 차례 수행하는 것은 어렵거나 오래 걸리는 일이 아니지만 특정 조건을 만족시키는 해시 계산 값이 나오게 하는 입력 값을 구하려면 상당히 많은 횟수의 계산을 반복해야 한다. 시간도 오래 걸린다. 하지만 입력 값을 구했다면 그 입력 값으로 해시를 계산한 결과가 특정 조건을 만족시키는지 확인하는 일은 아주 쉽다. 입력 값이 같으면 해시 계산 결과 값은 항상 같기 때문에 해시 계산 한 차례만 수행한 후 그 결과 값이 특정 조건을 만족시키는지 확인하면 된다. 해시 함수의 특징을 정리하면 답을 구하는 데 오랜 시간이 걸리지만 구한 답이 맞는지 검증하기는 매우 쉽다는 것이다.

   이러한 특징 때문에 블록의 고유 번호를 계산할 때 해시 함수를 사용한다. 아무 해시 값이나 블록의 고유 번호가 될 수 있는 것은 아니다. 어떤 입력 값을 넣고 해시를 계산한 결과가 특정 조건을 만족시켜야 그 해시의 계산 결과 값이 블록의 고유 번호가 될 수 있다. 그러면 입력 값과 특정 조건이 무엇인지 알아봐야 한다.

   블록의 고유 번호 역할을 하는 블록 해시는 버전, 앞 블록의 블록 해시, 블록 내 모든 거래 정보의 해시, 블록 생성 시각, 난이도, 난스 등 6가지 블록 헤더 정보를 입력 값ㄷ으로 하고 SHA256해시 함수로 계산한 값으로, 32바이트의 숫자 값이다. 





암호화폐가 은행을 대신하려면 1) 거래 내역을 안전하게 보관, 2) 거래 내역이 진짜인지 검증 이 필요함.

- 거래 내역 보관(장부 보관)

  블록체인은 모두에게 장부의 사본을 나눠주어 각자의 컴퓨터에 저장함(한 개인이 손상되어도 전체 장부에 이상x)

  장부는 신규 거래가 일정량이 쌓이면 자동으로 동기화됨. 업데이트 되는 한 묶음 = 블록

  각 블록의 내용은 암호화. if) 블록의 거래 내용이 바뀌면 봉인이 풀려 버려지게 됨. (이 블록 뒤에 연결된 블록도 모두 함께)

  => 한번 기록되면 변경/삭제 불가능

  **장부 암호화 방법**

  블록 생성 문제 ex) 이 블록은 블록에 담긴 모든 거래 내역(A)와 앞 블록의 결과값(B), 봉인코드(C)를 더해 '00'으로 시작하는 해시값이 나와야함. 여기서 봉인 코드(C)를 찾으시오.

  A+B+C = '00~' 이 나와야만 이 블록을 '진짜'라고 인정함. 여기서 A,B는 알고 있는 값이므로 C값만 알면 유효한 블록을 만들 수 있음. 

  누군가 이 C값을 찾아 모든 사람에게 알림 -> 사람들은 맞는지 각각 자신이 가진 A,B값을 더해 확인 -> 과반수 이상의 사람이 C값이 봉인 코드가 맞다 하면, 찾은 사람은 블록을 생성할 권리를 얻음 + C값으로 블록을 암호화

  -> 이제부터는 누구도 블록의 내용을 수정할 수 없게 됨. 누군가 거래 내역(A)를 바꾸면 해시값도 바뀌므로 사람들은 이 내용이 잘못되었음을 알게됨.

  사후 조작 방지

  50개의 블록 중 어떤 사람이 45번째 블록을 수정하려고 함 -> 거래 내역(45-1)을 수정한 다음에 새로운 봉인코드를 찾아내면 유효하게 인정이 됨

  => 불가능 (동시에 유효한 블록이 여러 개 생기면, '가장 긴 체인'만을 진본으로 인식하게 됨).

  => 수정한 블록이 유효하려면 진짜 블록을 풀고 있는 사람보다 빠르게 봉인 코드를 풀어야 됨.

  -> 여기서 비트코인은 나쁜 사람을 소수라 보고 다수의 착한 사람보다 항상 느릴 수밖에 없다고 봄. 문제를 푸는 참가자가 많을 수록 사후적으로 문제를 풀어 내용을 변경하는 것은 불가능.

- 거래 내역 검증

  사람들이 돌아가면서 블록을 검증하도록 만듦(권력 분산). 

  1) 랜덤에서 '비용' 발생 : 검증자의 신뢰성을 높이기 위해 필요. 검증에 참여하는 사람은 많은 돈을 씀으로 자신의 신뢰성을 증명함. 

  2) 검증자에게 보상 지급 : 검증의 대가로 보상(암호화폐)을 지급함. 암호화폐 : 가치가 변하고 사용자가 많을수록 커짐(공급고정). 

     사용자가 많아지려면 네트워크가 신뢰성있게 운영되어야 => 검증을 제대로 해야 네트워크 신뢰 유지 => 보상의 가치 증가 

  **검증할 사람을 뽑는 방법**

  비트코인은 매 블록마다 문제를 냄. ex) 간단하게 '00'으로 시작하는 해시 출력값이 나오게 하는 입력값은?

  > 해시함수의 3가지 특징
  >
  > 1) 입력값은 무엇이든지 될 수 있지만, 출력값은 형식이 정해져 있음
  >
  > 2) 1글자만 달라져도 완전히 다른 숫자가 나옴(규칙성도 없음) - 입력값을 유추하는 것이 불가능한 일방함수
  >
  > 3) 같은 입력값을 넣으면 반드시 같은 출력값이 나옴
  >
  > 4) 어떤 길이의 입력값에 대해서도 동일한 길이의 출력값을 생성

  => 출력값을 알려면 직접 모든 단어를 넣어볼 수밖에 없음(규칙성이 없어서).

  이는 너무 어려워서 웬만한 컴퓨터는 푸는게 불가능함 -> 좋은 컴퓨터 구비 + 전기 

  => 이것이 검증자가 되기 위한 '비용'

  또 자동적으로 문제 난이도가 계속 올라감 -> 아무리 슈퍼 컴퓨터라도 계속 비용 발생

  이와 같이 비용이 드는 '작업'을 시켜 검증할 사람을 뽑음 = '작업 증명(Proof-of-work, PoW)' = 작업을 통해 신뢰를 증명



  각각의 노드들은 블록에 기록하는 데이터가 위변조되지 않은 원본이라는 것을 상호간에 합의하는 과정 필요. 

  다수의 노드들이 상호 검증을 거쳐 올바른 블록 생성을 이끌어내는 프로세스와 알고리즘 = 컨센서스(합의) Consensus

  컨센서스는 블록체인에서 가장 중요한 개념 중 하나로 어떤 컨센서스 알고리즘을 사용하는지가 블록체인의 기술력과 경쟁력으로 여겨짐. 

  > 비트코인 , 이더리움 - PoW(Proof-of-work)
  >
  > 이오스, 스팀 - DPos 방식

  1) PoW(Proof-of-Work) : 작업 증명

  블록 생성 시간동안 가장 많은 해시파워를 제공한 노드가 블록을 생성할 수 있도록 설계됨.

  해시 파워를 만드는 과정 = 채굴, 마이닝(Mining) = 암호화된 거래정보를 푼 뒤, 새로운 블록을 체인에 연결하는 작업

  장점

  - 주류 코인들이 채택(비코, 비캐, 비골, 라코)
  - 강력한 보안성
  - 서비스 남용을 쉽게 방지

  단점

  - 높은 전력소모로 자원 낭비
  - 지속적으로 해시파워 유지해야
  - 특정 마이닝 세력의 해시 독점으로 인한 생태계 교란 우려

  2) PoS(Proof-of-Stake) : 지분증명

  코인을 보유한 지분율에 따라 새롭게 생성하는 코인을 분배받는 방식. PoW와 다르게 일정 수 이상의 코인을 보관하고 있는 지갑을 블록체인 네트워크에 연결시켜 놓기만 하면 보상(이자)을 받을 수 있음.

  또 지분을 많이 가지고 있는 노드에게 블록을 생성할 권한을 줌(블록생성자와 지분생성자의 이해관계를 일치시켜 나쁜 의도로 생성할 동기부여를 없앰)

  장점

  - 해시파워가 많이 필요하지 않아 경제적이고 친화적임.
  - 블록 생산자의 탈중앙화로 안정성 확보
  - 블록 생성위해 지분을 담보로 잡아야 하기 때문에 덤핑 방지

  단점

  - 보안성 검증x
  - 고래들이 권력 독점 가능성 큼

  3) DPoS(Delegated Proof-of-Stake) : 위임된 지분증명

  PoS 알고리즘을 변형한 형태로 위임된 지분증명 방식.

  네트워크의 모든 노드의 투표 결과로 선출한 상위노드(증인 Witness)에게 권한을 위임하여 합의하는 방식. 일정 수의 증인들은 모든 권한을 위임 받아 블록 생성을 담당.

  장점

  - PoS에 비해 많은 트랜잭션을 빨리 처리(노드 수가 적기 때문)
  - PoW에 비해 비용 낮음
  - 하드포크의 위험 낮음
  - 증인들이 투표에 참여할 인센티브 분명

  단점

  - 증인끼리 담합 위험
  - 공개된 소수의 증인에 대한 디도스 공격 위험

블록체인의 3가지 특성

1. 장부에 쓰인 내용 수정/변경 불가능
2. 모든 사람이 장부 사본을 가지고 있으며 언제든지 확인 가능
3. 기록하기 전에 여러 명의 '정직한' 사람들이 내용 검증



참고

https://github.com/yunho0130/awesome-blockchain-kor/blob/master/media/reading-blockchain-via-desire.md

https://brunch.co.kr/@bumgeunsong/50

https://brunch.co.kr/@bumgeunsong/51

https://steemit.com/kr/@donekim/consensus-pow-pos-dpos